<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virtual Number â€“ Junaid Niz</title>

  <!-- Google Search Console -->
  <meta name="google-site-verification" content="RgLzzD5mPp_MOfX4RmzwXHX4-kjK5uf7oO3efnUJQzU" />

  <!-- Tailwind, Feather, Fonts -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

  <!-- google-libphonenumber (auto country + flag from phone) -->
  <script src="https://cdn.jsdelivr.net/npm/google-libphonenumber@3.2.31/dist/libphonenumber.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #0b0b0d;
      color: #e5e7eb;
      padding: 1rem;
    }

    .vip-title {
      background: linear-gradient(90deg, #FFD700, #FFAA00, #8E2DE2, #4A00E0);
      background-size: 300% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shine 6s linear infinite;
      font-weight: 900;
    }

    @keyframes shine {
      0% { background-position: 0%; }
      100% { background-position: 300%; }
    }

    .sms-scroll {
      max-height: none;
      overflow-y: visible;
    }
  </style>
</head>

<body>
<div class="max-w-6xl mx-auto space-y-6">

  <!-- HEADER -->
  <header class="flex flex-col sm:flex-row justify-between items-center py-4 border-b border-gray-700 gap-4">
    <div>
      <h1 class="text-3xl vip-title">ğŸ’ Junaid Niz ğŸ’</h1>
      <p class="text-sm text-gray-400 mt-1">
         Welcome To Junaid Niz ğŸ’.
      </p>
    </div>

    <div class="flex flex-wrap gap-2 justify-center">
      <!-- Get Free Numbers = opens new page -->
      <a href="numbers.html"
         class="px-4 py-2 bg-yellow-400 text-black rounded-lg font-semibold text-sm shadow hover:opacity-90">
         â˜ï¸ Get  Numbers
      </a>

      <a href="https://t.me/+8uILVxT_n6lhYzFk" target="_blank"
         class="px-4 py-2 bg-blue-600 rounded-lg font-semibold text-sm">
         ğŸ“¢ Main Channel
      </a>

      <a href="https://t.me/+c4VCxBCT3-QzZGFk" target="_blank"
         class="px-4 py-2 bg-green-600 rounded-lg font-semibold text-sm">
         ğŸ“ Numbers Channel
      </a>
    </div>
  </header>

  <!-- OTP / SMS SECTION -->
  <section>
    <div class="flex justify-between items-center mb-2">
      <h2 class="text-2xl font-bold flex items-center gap-2">
        <i data-feather="message-square" class="w-6 h-6 text-yellow-400"></i>
        Incoming OTP Messages
      </h2>
      <button id="refreshSmsBtn"
              class="px-3 py-1.5 text-xs bg-yellow-400 text-black font-semibold rounded-lg flex items-center gap-1">
        <i id="refreshSmsIcon" data-feather="refresh-cw" class="w-4 h-4"></i>
        Refresh SMS
      </button>
    </div>

    <!-- ğŸ” SMS SEARCH BOX -->
    <div class="mt-1 mb-3">
      <input id="smsSearchBox"
             type="text"
             placeholder="Search OTP / Number / Service / Country / Messageâ€¦"
             class="w-full bg-[#18181b] border border-gray-700 text-gray-200 text-sm rounded-lg p-2">
    </div>

    <div id="smsStatus" class="text-yellow-400 py-2 text-center text-sm">Loading SMSâ€¦</div>

    <div class="bg-[#18181b] rounded-xl shadow-xl sms-scroll">
      <table class="min-w-full text-xs sm:text-sm">
        <thead class="bg-[#242427] sticky top-0 z-10">
          <tr>
            <th class="px-3 py-3 text-left w-4/5">Details</th>
            <th class="px-3 py-3 text-center w-1/5">Analyze</th>
          </tr>
        </thead>
        <tbody id="otpTableBody"></tbody>
      </table>
    </div>
    <p id="smsError" class="text-red-400 text-center text-sm pt-2 hidden"></p>
  </section>

</div>

<script>
  feather.replace();

  // ---------- PHONE / FLAG HELPERS ----------
  const phoneUtil = window.libphonenumber
    ? window.libphonenumber.PhoneNumberUtil.getInstance()
    : null;

  const regionNames = (typeof Intl !== "undefined" && Intl.DisplayNames)
    ? new Intl.DisplayNames(["en"], { type: "region" })
    : null;

  function flagFromRegion(regionCode) {
    if (!regionCode) return "ğŸŒ";
    const base = 127462; // 'A'
    return regionCode
      .toUpperCase()
      .split("")
      .map(c => String.fromCodePoint(base + c.charCodeAt(0) - "A".charCodeAt(0)))
      .join("");
  }

  const FLAG_FALLBACK = {
    "COMOROS": "ğŸ‡°ğŸ‡²", "Comoros": "ğŸ‡°ğŸ‡²",
    "Pakistan": "ğŸ‡µğŸ‡°", "PAKISTAN": "ğŸ‡µğŸ‡°",
    "Nigeria": "ğŸ‡³ğŸ‡¬", "NIGERIA": "ğŸ‡³ğŸ‡¬",
    "Nepal": "ğŸ‡³ğŸ‡µ", "NEPAL": "ğŸ‡³ğŸ‡µ",
    "Morocco": "ğŸ‡²ğŸ‡¦", "MOROCCO": "ğŸ‡²ğŸ‡¦",
    "Burkina Faso": "ğŸ‡§ğŸ‡«", "BURKINA FASO": "ğŸ‡§ğŸ‡«",
    "India": "ğŸ‡®ğŸ‡³", "Bangladesh": "ğŸ‡§ğŸ‡©", "Afghanistan": "ğŸ‡¦ğŸ‡«",
    "Ethiopia": "ğŸ‡ªğŸ‡¹", "Kyrgyzstan": "ğŸ‡°ğŸ‡¬",
    "Kazakhstan": "ğŸ‡°ğŸ‡¿", "Tajikistan": "ğŸ‡¹ğŸ‡¯",
    "Ukraine": "ğŸ‡ºğŸ‡¦", "Congo": "ğŸ‡¨ğŸ‡¬",
    "Venezuela": "ğŸ‡»ğŸ‡ª"
  };

  function cleanCountryFromGroup(raw) {
    if (!raw) return "Unknown";
    let c = String(raw).trim();
    c = c.split("-")[0].trim();
    const digitIndex = c.search(/[0-9]/);
    if (digitIndex !== -1) c = c.slice(0, digitIndex).trim();
    c = c.replace(/\s+/g, " ");
    return c || "Unknown";
  }

  function getCountryInfo(numberStr, groupText) {
    try {
      if (phoneUtil && numberStr) {
        let n = String(numberStr).trim();
        if (!n.startsWith("+")) n = "+" + n;
        const parsed = phoneUtil.parseAndKeepRawInput(n, "");
        const region = phoneUtil.getRegionCodeForNumber(parsed);
        if (region) {
          const countryName = regionNames ? regionNames.of(region) : region;
          const flag = flagFromRegion(region);
          return { country: countryName || "Unknown", flag };
        }
      }
    } catch (e) {
      console.warn("phoneUtil error", e);
    }
    const cg = cleanCountryFromGroup(groupText);
    const flag = FLAG_FALLBACK[cg] || FLAG_FALLBACK[cg.toUpperCase()] || "ğŸŒ";
    return { country: cg, flag };
  }

  function maskNumber(n) {
    if (!n) return "N/A";
    const s = String(n);
    if (s.length <= 7) return s;
    return s.slice(0, 4) + "****" + s.slice(-3);
  }

  // ---------------- API LISTS (OTP ONLY) ----------------
  const CORS = "https://corsproxy.io/?";
  const SMS_APIS = [
    "https://www.kamibroken.pw/api/sms1?type=sms&iDisplayLength=10000",
    "https://www.kamibroken.pw/api/sms?type=sms&iDisplayLength=10000",
    "https://www.junaidniz.pw/api/tempotps?type=sms",
    "https://www.junaidniz.pw/api/tempotp?type=sms",
  ].map(u => CORS + encodeURIComponent(u));

  // ---------------- DOM ELEMENTS ----------------
  const smsStatus    = document.getElementById("smsStatus");
  const smsError     = document.getElementById("smsError");
  const otpTableBody = document.getElementById("otpTableBody");
  const refreshSmsBtn  = document.getElementById("refreshSmsBtn");
  const refreshSmsIcon = document.getElementById("refreshSmsIcon");
  const smsSearchBox   = document.getElementById("smsSearchBox");

  let allSmsData = [];

  // ---------------- FETCH SMS (old perfect style) ----------------
  async function fetchSMS() {
    smsStatus.textContent = "Loading SMSâ€¦";
    smsError.classList.add("hidden");
    otpTableBody.innerHTML = "";
    refreshSmsBtn.disabled = true;
    refreshSmsIcon.classList.add("animate-spin");

    try {
      const results = [];

      for (const url of SMS_APIS) {
        try {
          const res = await fetch(url);
          if (!res.ok) {
            console.warn("SMS API HTTP", res.status, url);
            continue;
          }
          const text = await res.text();
          let json;
          try {
            json = JSON.parse(text);
          } catch (e) {
            console.warn("Not JSON from", url, text.slice(0, 200));
            continue;
          }

          let rows = [];
          if (json && Array.isArray(json.aaData)) rows = json.aaData;
          else if (json && Array.isArray(json.data)) rows = json.data;
          else if (Array.isArray(json)) rows = json;

          if (rows.length) results.push(...rows);
        } catch (err) {
          console.warn("SMS API error", url, err);
        }
      }

      if (!results.length) {
        smsStatus.textContent = "No SMS from any API.";
        return;
      }

      const seen = new Set();
      const unique = [];
      for (const row of results) {
        if (!Array.isArray(row) || row.length < 5) continue;
        const key = String(row[0]) + "|" + String(row[2]) + "|" + String(row[4]);
        if (!seen.has(key)) {
          seen.add(key);
          unique.push(row);
        }
      }

      allSmsData = unique;
      renderSmsTable();

    } catch (e) {
      console.error("fetchSMS error", e);
      smsStatus.textContent = "";
      smsError.textContent = e.message || "Failed to load SMS.";
      smsError.classList.remove("hidden");
    } finally {
      refreshSmsBtn.disabled = false;
      refreshSmsIcon.classList.remove("animate-spin");
    }
  }

  function renderSmsTable(customList = null) {
    const data = customList || allSmsData;

    if (!data.length) {
      smsStatus.textContent = "No recent OTP messages found.";
      otpTableBody.innerHTML = "";
      return;
    }

    let html = "";
    data.forEach(row => {
      if (!Array.isArray(row) || row.length < 5) return;
      const time    = row[0];
      const group   = row[1];
      const number  = row[2];
      const service = row[3];
      const msg     = row[4] || "";

      const { country, flag } = getCountryInfo(number, group);
      const masked  = maskNumber(number);
      const otpMatch = String(msg).match(/\b\d{4,8}\b/);
      const otp     = otpMatch ? otpMatch[0] : "N/A";

      html += `
        <tr class="border-b border-gray-800 align-top">
          <td class="px-3 py-3">
            <b>${flag} New ${country} ${service} OTP!</b>
            <div class="mt-1 text-gray-300 space-y-0.5">
              <blockquote>ğŸ•° Time: ${time}</blockquote>
              <blockquote>${flag} Country: ${country}</blockquote>
              <blockquote>ğŸ“ Number: ${masked}</blockquote>
              <blockquote>ğŸ”‘ OTP: <code>${otp}</code></blockquote>
            </div>
            <p class="mt-2 text-gray-400 text-xs sm:text-sm">
              ${String(msg).replace(/\n/g, "<br>")}
            </p>
          </td>
          <td class="px-3 py-3 text-center align-top">
            <button class="px-2 py-1 bg-gray-800 rounded text-xs">AI</button>
          </td>
        </tr>
      `;
    });

    otpTableBody.innerHTML = html;
    smsStatus.textContent = `Loaded ${data.length} SMS messages.`;
  }

  function applySmsSearchFilter() {
    const q = smsSearchBox.value.toLowerCase().trim();
    if (!q) {
      renderSmsTable();
      return;
    }

    const filtered = allSmsData.filter(row => {
      if (!Array.isArray(row)) return false;
      const time    = String(row[0]).toLowerCase();
      const group   = String(row[1]).toLowerCase();
      const number  = String(row[2]).toLowerCase();
      const service = String(row[3]).toLowerCase();
      const message = String(row[4]).toLowerCase();
      return (
        time.includes(q) ||
        group.includes(q) ||
        number.includes(q) ||
        service.includes(q) ||
        message.includes(q)
      );
    });

    renderSmsTable(filtered);
  }

  // ---------------- INIT ----------------
  document.addEventListener("DOMContentLoaded", () => {
    fetchSMS();
    refreshSmsBtn.addEventListener("click", fetchSMS);
    smsSearchBox.addEventListener("input", applySmsSearchFilter);
  });
</script>

</body>
</html>
